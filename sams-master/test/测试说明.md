# 测试说明文档

## 测试文件结构

我为项目的每个关键环节都创建了对应的测试文件：

1. **address_test.go** - 地址相关功能测试
   - `TestGetAddress` - 测试获取地址列表
   - `TestSaveDeliveryAddress` - 测试保存配送地址

2. **store_test.go** - 商店相关功能测试
   - `TestCheckStore` - 测试获取可用商店列表

3. **cart_test.go** - 购物车相关功能测试
   - `TestCheckCart` - 测试获取购物车商品

4. **goods_test.go** - 商品校验功能测试
   - `TestCheckGoods` - 测试商品校验逻辑

5. **settle_test.go** - 结算信息功能测试
   - `TestCheckSettleInfo` - 测试获取结算信息

6. **capacity_test.go** - 配送时间功能测试
   - `TestGetCapacity` - 测试获取配送时间段

7. **commitpay_test.go** - 提交订单功能测试
   - `TestCommitPay` - 测试提交订单

## 运行测试

### 运行所有测试
```bash
cd sams-master
go test ./test -v
```

### 运行特定测试文件
```bash
# 测试地址功能
go test ./test -v -run TestGetAddress

# 测试商店功能
go test ./test -v -run TestCheckStore

# 测试购物车功能
go test ./test -v -run TestCheckCart
```

### 运行特定测试用例
```bash
# 运行地址解析测试
go test ./test -v -run TestGetAddress/测试地址数据解析

# 运行商品数量调整测试
go test ./test -v -run TestCheckCart/测试商品数量自动调整逻辑
```

## 测试覆盖范围

### 1. 地址功能测试
- ✅ 地址数据解析
- ✅ 地址结构体验证
- ✅ 保存地址请求格式
- ✅ 保存地址响应解析
- ✅ 认证失败场景

### 2. 商店功能测试
- ✅ 商店列表解析
- ✅ Store结构体验证
- ✅ 获取商店请求数据格式

### 3. 购物车功能测试
- ✅ 购物车数据解析
- ✅ 商品数量自动调整逻辑（库存、限购、剩余可购买数）
- ✅ FloorInfo结构体验证
- ✅ 限流错误处理

### 4. 商品校验测试
- ✅ 商品校验成功场景
- ✅ 商品缺货场景
- ✅ NormalGoods转Goods
- ✅ 商品有效性判断（库存、上架状态、可用性）

### 5. 结算信息测试
- ✅ 结算信息解析
- ✅ SettleInfo结构体验证
- ✅ 免运费检查逻辑
- ✅ 各种结算错误处理（限流、配送模式不匹配、购物车变化）

### 6. 配送时间测试
- ✅ 配送时间数据解析
- ✅ 时间段筛选逻辑（约满、禁用）
- ✅ Capacity结构体验证
- ✅ 请求日期格式验证
- ✅ 配送时间错误处理

### 7. 提交订单测试
- ✅ 订单提交成功场景
- ✅ Order结构体验证
- ✅ 订单提交请求数据格式
- ✅ 各种订单错误场景（限流、限购、缺货、时间段失效、运力、门店关闭、超重）
- ✅ 支付方式验证（微信、支付宝）
- ✅ 优惠券使用验证

## 测试特点

1. **使用模拟数据**：所有测试都使用模拟的JSON响应数据，不需要真实的API调用
2. **数据解析验证**：验证程序能否正确解析API返回的JSON数据
3. **业务逻辑验证**：验证关键业务逻辑（如数量调整、时间段筛选等）
4. **错误场景覆盖**：测试各种错误场景的处理
5. **结构体验证**：验证数据结构是否正确

## 注意事项

1. 这些测试主要验证**数据解析和业务逻辑**，不涉及真实的网络请求
2. 如果需要测试真实的API调用，需要提供有效的`authToken`
3. 测试中的模拟数据格式基于实际API响应结构
4. 所有测试都可以独立运行，不依赖外部服务

## 扩展测试建议

如果需要更完整的测试，可以考虑：

1. **集成测试**：使用真实的API进行端到端测试（需要有效的authToken）
2. **性能测试**：测试程序在高频请求下的表现
3. **并发测试**：测试多线程/多协程场景下的安全性
4. **错误恢复测试**：测试各种错误场景下的重试机制

