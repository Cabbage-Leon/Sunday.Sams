# 可视化UI使用说明

## 🎉 功能特点

1. **可视化界面**：友好的Web界面，无需命令行操作
2. **实时监控**：实时显示执行步骤、商品列表、配送时间等
3. **实时日志**：所有操作日志实时显示，方便调试
4. **状态管理**：清晰的状态指示器，一目了然
5. **响应式设计**：支持桌面和移动设备

## 🚀 快速开始

### 1. 安装依赖

```bash
cd sams-master
go get github.com/gorilla/websocket
go mod tidy
```

### 2. 启动服务器

```bash
go run . server
```

或者指定端口：

```bash
go run . server 8080
```

### 3. 打开浏览器

访问：`http://localhost:8080`

## 📖 使用步骤

### 第一步：配置参数

1. **Auth Token**（必填）
   - 从山姆APP的HTTP请求头中获取 `auth-token`
   - 这是最重要的参数，必须填写

2. **地址ID**（可选）
   - 如果不填，程序会自动提示选择地址
   - 如果填写，将使用指定的地址

3. **配送类型**
   - 极速达：快速配送
   - 全城配：标准配送（默认）

4. **支付方式**
   - 微信支付（默认）
   - 支付宝

5. **其他参数**（可选）
   - Bark通知ID：用于推送通知
   - 经纬度：用于定位
   - 优惠券ID：多个用逗号分隔
   - 仅免运费下单：勾选后只在下单时如果免运费才下单
   - 仅选择已勾选商品：只处理购物车中已勾选的商品

### 第二步：保存配置

点击"保存配置"按钮，系统会：
- 验证authToken
- 获取地址列表
- 初始化会话

如果成功，会显示选中的收货地址信息。

### 第三步：开始抢购

点击"开始抢购"按钮，系统将自动执行以下流程：

1. **保存配送地址** - 将地址保存到购物车
2. **查找商店** - 根据地址查找可用门店
3. **检查购物车** - 获取购物车中的商品
4. **校验商品** - 确认商品可购买
5. **结算信息** - 计算运费
6. **获取配送时间** - 查询可用时间段
7. **提交订单** - 自动提交订单

### 第四步：监控执行

在右侧面板可以实时看到：
- **执行流程**：当前执行到哪一步
- **购物车商品**：显示所有有效商品
- **可用配送时间**：显示找到的可用时间段
- **订单信息**：如果成功，显示订单详情

底部日志面板显示所有操作日志。

### 第五步：完成支付

如果抢购成功，会显示订单信息，请前往山姆APP完成支付。

## 🎨 界面说明

### 状态指示器

- 🔴 **未运行**：程序未启动
- 🟢 **运行中**：程序正在执行
- 🔵 **抢购成功**：订单已提交成功
- ⚠️ **错误**：发生错误

### 步骤说明

每个步骤都有对应的图标和说明：
- ⏸️ 等待开始
- 🚀 正在启动
- 📍 保存地址
- 🏪 查找商店
- 🛒 检查购物车
- 🔍 校验商品
- 💰 结算信息
- ⏰ 获取配送时间
- 📦 提交订单
- 🎉 订单成功

### 日志级别

- **INFO**：一般信息（蓝色）
- **SUCCESS**：成功信息（绿色）
- **ERROR**：错误信息（红色）
- **WARNING**：警告信息（橙色）

## ⚙️ 高级功能

### WebSocket实时通信

系统使用WebSocket实现实时通信，无需刷新页面即可看到最新状态。

### 自动重试机制

程序内置了完善的错误处理和重试机制：
- 限流错误：自动等待后重试
- 缺货错误：重新检查购物车
- 时间段失效：尝试下一个时间段
- 超重错误：自动减少商品数量

### 多时间段支持

如果找到多个可用时间段，程序会依次尝试，直到成功或全部失败。

## 🔧 故障排除

### 问题1：无法连接服务器

- 检查服务器是否启动
- 检查端口是否被占用
- 检查防火墙设置

### 问题2：配置保存失败

- 检查authToken是否正确
- 检查网络连接
- 查看日志面板的错误信息

### 问题3：无法获取商品

- 确认购物车中有商品
- 检查商品是否在售
- 检查配送类型是否匹配

### 问题4：WebSocket断开

- 系统会自动重连
- 如果持续断开，检查网络稳定性

## 📱 移动端使用

界面支持响应式设计，可以在手机浏览器中使用：
1. 确保手机和电脑在同一网络
2. 使用电脑的IP地址访问（如：`http://192.168.1.100:8080`）
3. 在手机浏览器中打开

## 🔒 安全提示

1. **AuthToken安全**：AuthToken是敏感信息，不要分享给他人
2. **本地运行**：建议在本地运行，不要部署到公网
3. **HTTPS**：如果部署到公网，建议使用HTTPS

## 📝 注意事项

1. 确保购物车中已有商品
2. 确保地址支持所选配送类型
3. 建议在商品有货时提前配置好
4. 程序会持续运行直到成功或手动停止

## 🆚 命令行模式 vs Web UI

### 命令行模式
```bash
go run main.go --authToken=xxx
```

### Web UI模式
```bash
go run . server
```

两种模式功能相同，Web UI提供更好的用户体验。

## 💡 使用技巧

1. **提前配置**：在商品有货前就配置好参数
2. **监控日志**：关注日志面板，了解执行情况
3. **及时支付**：抢购成功后尽快前往APP支付
4. **多时间段**：程序会自动尝试多个时间段，提高成功率

## 🐛 报告问题

如果遇到问题，请查看：
1. 日志面板的错误信息
2. 浏览器控制台的错误（F12）
3. 服务器终端的日志

---

**祝您抢购顺利！** 🎉

